_code segment
assume cs:_code, ds:_data, ss:_stack

start:    mov ax, _data          ; ustaw segment danych
          mov ds, ax           ; załaduj DS segment danych
          mov ax, _stack        ; ustaw segment stosu
          mov ss, ax           ; załaduj SS segment stosu
          mov sp, offset top   ; ustaw wskaźnik stosu na koniec stosu

          mov ah, 09h          ; wyświetlenie prośby o wprowadzenie liczby
          lea dx, tekst_wprowadz
          int 21h

wczytaj_cyfre:
          mov ah, 01h          ; wczytanie cyfry
          int 21h
          cmp al, 0Dh          ; sprawdzenie, czy wciśnięto Enter
          je koniec_wczytywania

          cmp bh, 1            ; sprawdzenie, czy to pierwsza cyfra
          je niepierwszy_znak
          mov bh, 1            ; ustawienie flagi pierwszej cyfry
          cmp al, '-'
          je minus

niepierwszy_znak:
          cmp al, '0'          ; sprawdzenie, czy znak to cyfra
          jb zly_znak
          cmp al, '9'
          ja zly_znak

          sub al, '0'          ; konwersja kodu ASCII na cyfrę
          mov cl, al           ; przechowanie cyfry w CL
          mov ax, liczba       ; załaduj aktualną wartość liczby
          mul mnoz_10          ; pomnóż przez 10
          add ax, cx           ; dodaj nową cyfrę
          mov liczba, ax       ; zapisz wynik w zmiennej liczba
          jmp wczytaj_cyfre

minus:
          mov bl, 1            ; ustawienie flagi liczby ujemnej
          jmp wczytaj_cyfre

zly_znak:
          mov ah, 09h          ; wyświetlenie błędu nieprawidłowego znaku
          lea dx, tekst_zly_znak
          int 21h
          jmp koniec_programu

koniec_wczytywania:
          cmp bl, 1            ; sprawdzenie, czy liczba jest ujemna
          jne pomin_negacje
          neg liczba           ; jeśli tak, neguj wartość liczby

pomin_negacje:
          mov ah, 09h          ; wyświetlenie tekstu "Podana liczba wynosi:"
          lea dx, tekst_wynik
          int 21h

          call wyswietl_bity   ; wywołanie procedury wyświetlania bitów

          mov ah, 09h          ; Wyświetlenie tekstu "Podana liczba w kodzie szesnastkowym wynosi:"
          lea dx, tekst_wynik_hex
          int 21h

          call wyswietl_hex    ; Wywołanie procedury wyświetlania liczby szesnastkowo

koniec_programu:
          mov ah, 4Ch          ; zakończenie programu
          mov al, 0
          int 21h

wyswietl_bity proc
          mov cx, 16           ; liczba bitów do wyświetlenia (16-bit)
          mov bx, 8000h        ; maska dla najbardziej znaczonego bitu (bit 15)

wyswietl_bit:
          mov ax, liczba       ; załaduj wartość liczby
          test ax, bx          ; sprawdzenie bitu z maską
          jz zero_bit          ; jeśli 0, przejdź do zero_bit
          mov dl, '1'          ; jeśli 1, ustaw DL na '1'
          jmp pokaz_znak

zero_bit:
          mov dl, '0'          ; ustaw DL na '0'

pokaz_znak:
          mov ah, 02h          ; funkcja DOS do wyświetlenia znaku
          int 21h

          shr bx, 1            ; przesunięcie maski w prawo
          loop wyswietl_bit    ; powtarzaj dla kolejnych bitów
          ret
wyswietl_bity endp

wyswietl_hex proc
          ; Wyświetlanie liczby w kodzie szesnastkowym
          mov cx, 4            ; liczba cyfr (16 bitów = 4 cyfry szesnastkowe)

WYSWIETL_CYFRE:
          mov dx, liczba       ; kopiowanie AX do DX
          shr dx, 12           ; przesunięcie w prawo o 12 bitów
          and dx, 0Fh          ; wyizolowanie 4 najmłodszych bitów

          ; Konwersja na znak ASCII
          cmp dl, 9            ; czy cyfra < 10?
          jle CYFRA_JEST
          add dl, 7           ; dla liter A-F
CYFRA_JEST:
          add dl, '0'         ; dodanie przesunięcia ASCII

          ; Wyświetlenie znaku
          mov ah, 02h          ; funkcja INT 21h do wyświetlania znaku
          int 21h

          shl liczba, 4        ; przesunięcie liczby w lewo o 4 bity
          loop WYSWIETL_CYFRE  ; zmniejszenie licznika
          ret
wyswietl_hex endp

_data segment
tekst_wprowadz db "Wprowadz liczbe od -32 768 do 32 767: $"
tekst_zly_znak db "Wprowadzono nieprawidlowy znak!$"
tekst_wynik db 13, 10, "Podana liczba w kodzie dwojkowym wynosi: $"
tekst_wynik_hex db 13, 10, "Podana liczba w kodzie szesnastkowym wynosi: $"
mnoz_10 dw 10
liczba dw 0
_data ends

_stack segment stack
    dw  100h dup(0)           ; rezerwacja pamięci na stos
    top label word            ; etykieta końca stosu
_stack ends

end start
